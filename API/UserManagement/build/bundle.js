!function(r){var t={};function i(e){if(t[e])return t[e].exports;var n=t[e]={i:e,l:!1,exports:{}};return r[e].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=r,i.c=t,i.d=function(e,n,r){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(n,e){if(1&e&&(n=i(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var t in n)i.d(r,t,function(e){return n[e]}.bind(null,t));return r},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=39)}([function(e,n){e.exports=require("graphql")},function(e,n){e.exports=require("validator")},function(e,n,r){"use strict";var t=r(4),i=r(1),o=r.n(i),a=r(15),s=new t.Schema({name:{type:String,trim:!0,required:!0},email:{type:String,required:!0,unique:!0,lowercase:!0,index:!0,trim:!0,validate:{validator:function(e){return o.a.isEmail(e)},message:"{VALUE} is not a valid {PATH}"}},password:{type:String,required:!0,unique:!0,trim:!0},googleId:{type:String},isVerified:{type:Boolean},createdAt:{type:String},updatedAt:{type:String}});s.method("comparePassword",function(e,r){Object(a.compare)(e,this.password,function(e,n){r(e,n)})}),s.pre("save",function(r){var t=this;if(!t.isModified)return r();Object(a.genSalt)(10,function(e,n){if(e)return r("some thing went wrong");Object(a.hash)(t.password,n,function(e,n){if(e)return r("can't hash the password,try again");t.password=n,r()})})});var u=Object(t.model)("user",s);n.a=u},function(e,n){e.exports=require("passport")},function(e,n){e.exports=require("mongoose")},function(e,n){e.exports=require("@babel/runtime/regenerator")},function(e,n){e.exports=require("moment")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("redis")},function(e,n){e.exports=require("chalk")},function(e,n){e.exports=require("@sendgrid/mail")},function(e,n){e.exports=require("@babel/runtime/helpers/typeof")},function(e,n){e.exports=require("bcrypt")},function(e,n){e.exports=require("dotenv")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("express-session")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("x-xss-protection")},function(e,n){e.exports=require("hpp")},function(e,n){e.exports=require("pdfkit")},function(e,n){e.exports=require("@babel/runtime/helpers/objectSpread")},function(e,n,r){var t=r(4),i=t.Schema,o=new i({IP:{type:String},visitedDay:{type:String},IPsInfo:{type:i.Types.ObjectId,ref:"visitorsInfo"}});e.exports=t.model("visitorsIP",o)},function(e,n,r){var t=r(4),i=new t.Schema({continent_name:{type:String},country_name:{type:String},state_prov:{type:String},district:{type:String},latitude:{type:Number},longitude:{type:Number},calling_code:{type:String},languages:{type:String},organization:{type:String},currency:{type:String}});e.exports=t.model("visitorsInfo",i)},function(e,n){e.exports=require("http")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("rotating-file-stream")},function(e,n){e.exports=require("express-graphql")},function(e,n){e.exports=require("ioredis")},function(e,n){e.exports=require("passport-google-oauth20")},function(e,n){e.exports=require("passport-local")},function(e,n){e.exports=require("ip-geolocation-api-javascript-sdk/GeolocationParams.js")},function(e,n){e.exports=require("ip-geolocation-api-javascript-sdk/IPGeolocationAPI")},function(e,n,r){"use strict";r.r(n);var t=r(5),a=r.n(t),i=r(9),o=r.n(i),s=r(3),u=r.n(s),c=r(33),l=r(2),p=r(8),f=r.n(p),d=r(34),m=r.n(d),h=r(6),g=r.n(h),y=r(11),w=r.n(y).a.createClient();r(16).config({path:f.a.resolve(process.cwd(),"config/keys/.env")}),u.a.serializeUser(function(e,n){n(null,e.id)}),u.a.deserializeUser(function(e,n){l.a.findById(e).then(function(e){n(null,e)})});var v={clientID:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,callbackURL:process.env.GOOGLE_AUTH_SUCCESS_CALLBACK,proxy:!0},b=new c.Strategy(v,function(){var i=o()(a.a.mark(function e(n,r,t,i){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.findOne({googleId:t.id});case 2:if(o=e.sent)return w.hset("lastLogIn",o.id,g()().format()),e.abrupt("return",i(null,o));e.next=6;break;case 6:new l.a({name:t.displayName,email:t.emails[0].value,password:t.id,googleId:t.id,createdAt:g()().format(),updatedAt:null,isVerified:!0}).save(function(e,n,r){if(e)return i(e,null);i(null,n)});case 8:case"end":return e.stop()}},e)}));return function(e,n,r,t){return i.apply(this,arguments)}}()),x=new m.a({usernameField:"email"},function(e,n,t){l.a.findOne({email:e.toLowerCase()},function(e,r){return e?t(e):r?void r.comparePassword(n,function(e,n){return e?t(e):n?(w.hset("lastLogIn",r.id,g()().format()),t(null,r)):t(null,!1,"Invalid_Credential")}):t(null,!1)})});u.a.use(x),u.a.use(b)},function(e,n){e.exports=require("connect-redis")},function(e,n,r){"use strict";r.r(n);var t=r(10),i=r.n(t),o=r(4),a=r.n(o),s=r(17),u=r.n(s),c=r(3),l=r.n(c),p=r(8),f=r.n(p),d=r(18),m=r.n(d),h=r(19),g=r.n(h),y=r(20),w=r.n(y),v=r(21),b=r.n(v),x=r(22),S=r.n(x),E=r(23),L=r.n(E),P=function(e,n,r){e.user?r():n.status(404).send({error:"You must log in!"})},q=r(5),G=r.n(q),I=r(9),O=r.n(I),N=r(7),Q=r.n(N),_=r(2),R=r(24),k=r.n(R),D={},j=[{id:1,name:"Kurtis Weissnat"},{id:2,name:"Nicholas Runolfsdottir"},{id:3,name:"Gelann Reichert"},{id:4,name:"Moriah Stanton"},{id:5,name:"Rey Padberg"}];D.rootPage=function(e,n){var r='\n        <div>\n        You don\'t appear to be logged in.  You can log in by visiting\n        <a href="/auth/google">the Authentication Route</a>. You could\n        also look at details about yourself at <a href="/api/current_user">the Current User route</a>\n        </div>\n    ';e.user&&(r='\n        <div>\n            You appear to be logged in, so you can visit <a href="/admins">the Admins route</a>\n            or you can\n            <form action="/logout" method="post">\n                <input type="hidden" name="_csrf" value="'.concat(e.csrfToken(),'"></input>\n                <button type="submit">Logout</button>\n            </form>\n        </div>\n        ')),n.send('\n        <div>\n        <h4>Hi!  Welcome to the React SSR API</h4>\n        <div>\n        <form action="/userslistpdf" method="get">\n        <button>usersListPdf</button>\n        </form>\n            You can see <a href="/users">the Users route</a>\n        </div>\n        '.concat(r,"\n        </div>\n    "))},D.usersList=function(e,o,n){var a,s=+e.query.page;s<1&&(s=1),_.a.find().countDocuments().then(function(e){return a=e,s>Math.ceil(a/10)&&(s=Math.ceil(a/10)),_.a.find().skip(10*(s-1)).limit(10)}).then(function(e){if(!e)return"no user has been registered yet";var n=e.map(function(e){return{_id:e._id,name:e.name,email:e.email,isVerified:e.isVerified}}),r=10*s<a,t=1<s,i=Math.ceil(a/10);o.send({Users:n,totalUsers:a,hasNextPage:r,hasPreviousPage:t,currentPage:s,lastPage:i})}).catch(function(e){n(new Error(e))})},D.logIn=function(e,n){n.send('\n    <html>\n      <body>\n        <a href="auth/google">Login via Google</a>\n      </body>\n    </html>')},D.admins=function(e,n){n.send(j)},D.redirectToRoot=function(e,n){n.redirect("/")},D.logOut=function(){var r=O()(G.a.mark(function e(n,r){return G.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.logout();case 2:r.redirect("/");case 3:case"end":return e.stop()}},e)}));return function(e,n){return r.apply(this,arguments)}}(),D.emailVerification=function(e,r,t){var n=e.query.token;Q.a.verify(n,"afsan|user|emailVerify|007",{subject:"emailVerification"},function(e,n){if(e)return"TokenExpiredError"===e.name?r.status(500).send("request expired please try again"):r.send({err:e});_.a.findOneAndUpdate({email:n.email},{$set:{isVerified:!0}},{new:!0},function(e,n){e&&t(new Error("can't find Email try again")),r.redirect("/")})})},D.resetPassword=function(e,r,n){var t=e.query.token;Q.a.verify(t,"afsan|user|resetPassword|007",{subject:"resetPassword"},function(e,n){if(e)return"TokenExpiredError"===e.name?r.status(500).send("request expired please try again"):r.send({err:e});r.send({email:n.email})})},D.printUsers=function(e,t,n){t.setHeader("Content-Type","application/pdf"),t.setHeader("Content-Disposition",'inline;filename="usersList"'),_.a.find().then(function(){var n=O()(G.a.mark(function e(n){var r;return G.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return","no user has been registered yet");case 2:r=new k.a,t.setHeader("Content-Type","application/pdf"),"userslist",t.setHeader("Content-Disposition",'inline; filename="userslist"'),r.pipe(t),r.fontSize(26).text("Invoice",{underline:!0}),r.text("-----------------------"),(n=n.map(function(e){return{name:e.name,email:e.email}})).forEach(function(e,n){r.text(n+")"+e.email+"---"+e.name)}),r.text("---"),r.end();case 13:case"end":return e.stop()}},e)}));return function(e){return n.apply(this,arguments)}}()).catch(function(e){n(new Error(e))})};var T=D,U=r(25),C=r.n(U),A=r(11),V=r.n(A),M=r(6),Y=r.n(M),B=r(12),F=r.n(B),z=r(26),H=r.n(z),K=r(27),J=r.n(K);r(16).config({path:f.a.resolve(process.cwd(),"config/keys/.env")});var W=V.a.createClient({retry_strategy:function(){return 1e3}});W.on("error",function(e){console.log(F.a.bgRedBright.bold("ERROR:")+F.a.bold("connecting to redis encountered with issue.\n"))});var $=r(35),X=new(r(36))(process.env.GEOLOCATION_IP_ADDRESS),Z={},ee=Y()().format("YYYY/M/D");function ne(e){var n=e.message,r=e.sourceCode,t=e.errorDetail;return F.a.white.bgRed.bold("\nERROR||")+"".concat(n,"\n")+"sourceCode:"+F.a.redBright.bold("[ipInfoSystem_".concat(r,")]\n"))+"[detail]:"+F.a.redBright.bold("".concat(JSON.stringify(t)))+"\n"}Z.storeSystem=function(){var r=O()(G.a.mark(function e(s,t){var n,r;return G.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=new Date,(r=new Date(n.getFullYear(),n.getMonth(),n.getDate(),24,0,0,0)-n)<0&&(r+=864e5),setInterval(function(){var a=Y()().subtract(1,"day").format("YYYY/M/D");W.hgetall(a,function(e,n){if(e)return s(ne({message:"Something went wrong on redis",sourceCode:"FetchVisitorDataFromRedis",errorDetail:e}));if(null==n)return s(ne({message:"receiving null as result for redis query ",sourceCode:"FetchVisitorDataFromRedis",errorDetail:"{queryResult:null}"}));var r=[];for(var t in n){var i=new J.a(JSON.parse(n[t])),o=new H.a({IP:t,visitedDay:a});o.IPsInfo=i,Promise.all([o.save(),i.save()]).catch(function(e){e&&r.push(e)})}if(0!==r.length)return s(ne({message:"something went wrong on storing fetched data from redis on mongoDB",sourceCode:"StoreFetchedDataOnDB",errorDetail:r}));W.del(a)})},r+2e4),W.hget(ee,t,function(e,n){if(e)return s(ne({message:"Something went wrong on redis",sourceCode:"FetchVisitorDataFromRedis",errorDetail:e}));if(null!==n)return s(null);var r=new $;r.setFields(["continent_name","country_name","state_prov","district","latitude","longitude","calling_code","languages","organization","currency"].join(",")),X.getGeolocation(function(e){if(e.message)return s(ne({message:"something went wrong on fetching IP information from protocol",sourceCode:"fetchInfoFromProtocol",errorDetail:e.message}));delete e.ip,e=C()({},e,{currency:e.currency.code}),e=JSON.stringify(e),W.hset(ee,t,e)},r)});case 5:case"end":return e.stop()}},e)}));return function(e,n){return r.apply(this,arguments)}}();var re=Z,te=i.a.Router(),ie=l.a.authenticate("google",{scope:["profile","email"]}),oe=l.a.authenticate("google");te.get("/auth/google",ie),te.get("/api/auth/google/callback",oe,T.redirectToRoot),te.get("/auth/google/callback",oe,T.redirectToRoot),te.post("/logout",P,T.logOut),te.get("/logout",P,T.logOut),te.get("/current_user",P,function(e,n){n.send(e.user)}),te.get("/emailverify",T.emailVerification,T.redirectToRoot),te.get("/resetPassword",T.resetPassword),te.get("/usersListPdf",T.printUsers),te.post("/userInfo",function(e,n){re.storeSystem(function(e){e&&console.log(e)},e.body.ip),n.end()});var ae=te,se=i.a.Router();se.get("/",T.rootPage),se.get("/users",T.usersList),se.get("/admins",P,T.admins),se.get("/login",T.logIn);var ue=se,ce=r(28),le=r.n(ce),pe=r(29),fe=r.n(pe),de=r(30),me=r.n(de),he=r(31),ge=r.n(he),ye=r(0),we=new ye.GraphQLObjectType({name:"UserType",fields:{id:{type:ye.GraphQLID},name:{type:ye.GraphQLString},email:{type:ye.GraphQLString},isVerified:{type:ye.GraphQLBoolean}}}),ve=r(1),be=r.n(ve),xe=r(13),Se=r.n(xe),Ee=r(7),Le=function(e){return{to:e.email,subject:"Successfully SignedIn[".concat(e.name,"]"),from:"af.hadafi@gmail.com",text:"and easy to do anywhere, even with Node.js",html:function(e){var n=Ee.sign({email:e.email,access:"simple_user"},"afsan|user|emailVerify|007",{expiresIn:3600,subject:"emailVerification"});return"\n    <html>\n        <body>\n            <div>\n                <h1>Email Verification</h1>\n                <a href='http://localhost:3000/api/emailverify?token=".concat(n,"'>\n                    <button>verifying my account</button>\n                </a>\n            </div>\n        </body>\n    </html>\n    ")}(e)}},Pe=r(7),qe=function(e){return{to:e.email,subject:"Rest Password",from:"af.hadafi@gmail.com",text:"and easy to do anywhere, even with Node.js",html:function(e){var n=Pe.sign({email:e.email,access:"simple_user"},"afsan|user|resetPassword|007",{expiresIn:3600,subject:"resetPassword"});return"\n    <html>\n        <body>\n            <div>\n                <h1>resetPassword</h1>\n                <a href='http://localhost:3000/resetPassword/".concat(n,"'>\n                    <button>reset my account Password</button>\n                </a>\n            </div>\n        </body>\n    </html>\n    ")}(e)}},Ge=V.a.createClient(),Ie={SignUp:function(e){var n=e.email,r=e.password,t=e.name,i=e.req,o=[];if((be.a.isEmpty(n)||be.a.isEmpty(r))&&o.push("type all credentials"),be.a.isEmail(n)||o.push("type valid Email"),be.a.isLength(r,{min:6,max:24})||o.push("password should be in 6 to 24 char range"),0<o.length)throw new Error(o);return _.a.findOne({email:n}).then(function(e){if(e)throw new Error("Email is in use");return new _.a({email:n,password:r,name:t,createdAt:Y()().format(),updatedAt:null,isVerified:!1}).save()}).then(function(t){return new Promise(function(n,r){i.login(t,function(e){return e&&r(e),Ge.hset("lastLogIn",t.id,Y()().format()),n(t)})})}).catch(function(e){throw new Error(e)})},SignIn:function(e){var n=e.email,i=e.password,o=e.req,r=[];if((be.a.isEmpty(n)||be.a.isEmpty(i))&&r.push("type all credentials"),be.a.isEmail(n)||r.push("type valid Email"),0<r.length)throw new Error(r);return new Promise(function(r,t){l.a.authenticate("local",function(e,n){return n?e?t(e):void o.login(n,function(e){return e?t(e):r(n)}):t("you are not registered yet please signUp first")})({body:{email:n,password:i}})})},sendEmailVerify:function(e){var i=e.email,n=(e.req,[]);if(be.a.isEmpty(i)&&n.push("email should be insert"),be.a.isEmail(i)||n.push("type valid Email"),0<n.length)throw new Error(n);return _.a.findOne({email:i}).then(function(e){if(be.a.isEmpty(e))throw new Error("user with this email doesn't exist");return Se.a.setApiKey(process.env.SEND_GRID_API_KEY),new Promise(function(r,t){Se.a.send(Le(e),!0,function(e,n){return e?t(e):r({email:i})})})}).catch(function(e){throw new Error(e)})},sendResetPassEmail:function(e){var i=e.email,n=(e.req,[]);if(be.a.isEmpty(i)&&n.push("email should be insert"),be.a.isEmail(i)||n.push("type valid Email"),0<n.length)throw new Error(n);return _.a.findOne({email:i}).then(function(e){if(be.a.isEmpty(e))throw new Error("user with this email doesn't exist");return Se.a.setApiKey(process.env.SEND_GRID_API_KEY),new Promise(function(r,t){Se.a.send(qe(e),!0,function(e,n){return e?t(e.message):r({email:i})})})}).catch(function(e){throw new Error(e)})},identifyUserByToken:function(e){var n=e.token;e.req;if(be.a.isEmpty(n))throw new Error("token has not been received.");return n=be.a.trim(n),new Promise(function(r,t){return Q.a.verify(n,"afsan|user|resetPassword|007",{subject:"resetPassword"},function(e,n){if(e)return"TokenExpiredError"===e.name?t("request expired please try again"):t(e);r({email:n.email})})})},updateUserPassword:function(e){var n=e.email,r=e.password,t=(e.req,[]);if((be.a.isEmpty(n)||be.a.isEmpty(r))&&t.push("type all credentials"),be.a.isEmail(n)||t.push("type valid Email"),be.a.isLength(r,{min:6,max:24})||t.push("password should be in 6 to 24 char range"),0<t.length)throw new Error(t);return _.a.findOne({email:n}).then(function(e,n){if(n)throw new Error("something went wrong,try again");if(!e)throw new Error("User not found");return e.password=r,e.save()}).then(function(e){Promise.resolve({email:n})}).catch(function(e){throw new Error(e)})}},Oe=Ie,Ne=new ye.GraphQLObjectType({name:"RootQueryType",fields:function(){return{user:{type:we,resolve:function(e,n,r){return r.user}},identifyUserByToken:{type:we,args:{token:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.token;return Oe.identifyUserByToken({token:t,req:r})}}}}}),Qe=new ye.GraphQLObjectType({name:"usersList",fields:{filter:{type:ye.GraphQLString},show:{type:new ye.GraphQLNonNull(ye.GraphQLInt)},search:{type:ye.GraphQLString}}}),_e=r(14),Re=r.n(_e),ke={show:function(e){var a,s=e.filter,u=e.show,c=e.search,l=e.page;u=Re()(u)===Number&&-1!==[10,20,30,50].findIndex(u)&&u,s=Re()(s)===String&&-1!==["Onlines","Recently Login","Recently Registered"].findIndex(s)&&filterArg,c=Re()(c)===String&&null!==c&&c,l=Re()(l)===Number&&1<l?l:1;return _.a.find(0==c?0==s?"":s:c).countDocuments().then(function(e){return a=e,l>Math.ceil(a/u)&&(l=Math.ceil(a/u)),_.a.find().skip((l-1)*u).limit(u)}).then(function(e){if(!e)return"no user has been registered yet";var n=e.map(function(e){return{_id:e._id,name:e.name,email:e.email,isVerified:e.isVerified}}),r=u*l<a,t=1<l,i=Math.ceil(a/u),o=Object.assign(n,{totalUsers:a,hasNextPage:r,hasPreviousPage:t,lastPage:i,show:u,filter:s,search:c,currentPage:l});res.send(o)}).catch(function(e){next(new Error(e))})}},De=ke,je={usersList:{type:Qe,args:{filter:{type:ye.GraphQLString},show:{type:new ye.GraphQLNonNull(ye.GraphQLInt)},search:{type:ye.GraphQLString},page:{type:ye.GraphQLInt}},resolve:function(e,n){var r=n.filter,t=n.show,i=n.search,o=n.page;return De.show({filter:r,show:t,search:i,page:o})}}},Te=new ye.GraphQLObjectType({name:"PageView",fields:{field:{type:ye.GraphQLString},counted:{type:ye.GraphQLInt}}}),Ue=r(32),Ce=new(r.n(Ue).a),Ae={pageViews:{type:Te,args:{field:{type:new ye.GraphQLNonNull(ye.GraphQLString)},key:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n){return function(e){var n=e.key,r=e.field;return Ce.hsetnx(n,r,0),Ce.hincrby(n,r,1).then(function(e){return{field:n,counted:e}})}({key:n.key,field:n.field})}}},Ve={SignIn:{type:we,args:{email:{type:new ye.GraphQLNonNull(ye.GraphQLString)},password:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.password,i=n.email;return console.log(t,i),Oe.SignIn({email:i,password:t,req:r})}},SignUp:{type:we,args:{name:{type:new ye.GraphQLNonNull(ye.GraphQLString)},email:{type:new ye.GraphQLNonNull(ye.GraphQLString)},password:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.email,i=n.password,o=n.name;return Oe.SignUp({email:t,password:i,name:o,req:r})}},SignOut:{type:we,resolve:function(e,n,r){var t=r.user;return r.logout(),t}},sendEmailVerify:{type:we,args:{email:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.email;return Oe.sendEmailVerify({email:t,req:r})}},sendResetPassEmail:{type:we,args:{email:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.email;return Oe.sendResetPassEmail({email:t,req:r})}},updateUserPassword:{type:we,args:{email:{type:new ye.GraphQLNonNull(ye.GraphQLString)},password:{type:new ye.GraphQLNonNull(ye.GraphQLString)}},resolve:function(e,n,r){var t=n.email,i=n.password;return Oe.updateUserPassword({email:t,password:i,req:r})}}},Me=new ye.GraphQLObjectType({name:"MutationObserver",fields:function(){return Object.assign(je,Ae,Ve)}}),Ye=new ye.GraphQLSchema({query:Ne,mutation:Me});r(37),a.a.connect(process.env.DB_ADDRESS,{useNewUrlParser:!0}),a.a.connection.on("connected",function(){console.log("connection established successfully")}),a.a.connection.on("error",function(e){console.log("connection to mongo failed "+e)}),a.a.connection.on("disconnected",function(){console.log("mongo db connection closed")}),a.a.set("useCreateIndex",!0),a.a.Promise=global.Promise;var Be=i()(),Fe=f.a.resolve("./logs");m.a.existsSync(Fe)||m.a.mkdirSync(Fe);var ze=me()("access.log",{interval:"1d",path:Fe});Be.use(fe()("combined",{stream:ze})),r(16).config({path:f.a.resolve(process.cwd(),"config/keys/.env")}),Be.use(w()()),Be.use(u.a.json()),Be.use(u.a.urlencoded({extended:!0})),Be.use(L()()),Be.disable("x-powered-by");var He=[process.env.CORS_MAINSITE_ADDRESS,"http://localhost:".concat(process.env.PORT)],Ke={origin:function(e,n){-1===He.indexOf(e)&&e?n(new Error("Not allowed by CORS")):n(null,!0)}};Be.use(b()(Ke));var Je=r(38)(g.a);Be.set("trust proxy",1);var We=le.a.createServer(Be),$e=new Date(Date.now()+36e5),Xe=g()({secret:"3f9faa8bc0e722172cc0bdafede9f3f217474e47",resave:!1,saveUninitialized:!1,store:new Je({prefix:"session:auth:"}),cookie:{maxAge:2592e6,expires:$e}});Be.use(Xe),Be.use(S()()),Be.use(l.a.initialize()),Be.use(l.a.session()),Be.use("/graphql",ge()({schema:Ye,graphiql:!0}));var Ze=r(40)({cookie:!0});Be.use("/",ae),Be.use("/",Ze,ue),Be.use(function(e,n,r){n.status(404).send("404")}),Be.use(function(e,n,r,t){r.locals.message=e.message,r.locals.error="development"===n.app.get("env")?e:{},r.status(e.status||500),r.send(e.message)}),We.listen(process.env.PORT,function(){console.log("[UserManagement]_server is running on port ".concat(process.env.PORT))})},function(e,n){e.exports=require("csurf")}]);